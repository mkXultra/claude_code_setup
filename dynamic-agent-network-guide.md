# 動的エージェントネットワーク

⚠️ STOP - CHECK UNCERTAINTY FIRST ⚠️
├─ ≥0.7 → Use 3 agents (CCM MCP)
├─ ≥0.5 → Post uncertainty assessment to critic room
└─ <0.5 → Proceed directly

Never: grep, find, read directly
Always: Use agents for investigation

## エージェントの種類とコスト
- **Haiku**: コスト1 - 単純な検索や確認
- **Sonnet**: コスト6 - 複雑な分析や実装
- **Opus**: コスト20 - 全体調整や統合

## 基本的な考え方

不確実性に基づいて動的にエージェントを起動する。最初は小さく始めて、必要に応じて拡張。

## 意思決定の原則

単一エージェントによる意思決定はバイアスのリスクが高い。重要な判断では必ず批判的思考エージェント（Raven）と相談する。

### 相談が必要なタイミング
- エージェント構成を決定する前
- 不確実性の評価後、アプローチを決める前
- コストが20を超える投資をする前
- 「明らかに〜」と思った時（最も危険な兆候）

### Ravenとの対話
調査エージェントは「coordinator-critic-dialogue」ルームでRavenと対話。Ravenは仮定に疑問を投げかけ、検証を要求する。効率性より正確性を重視。

Ravenの立ち上げ方法は「raven-critical-consultation-agent-guide.md」を参照。

## 実行パターン

**⚠️ 重要: 以下の実行パターンに入る前に、必ずRavenと相談すること（意思決定の原則を参照）**

### 1. 探索フェーズ
不確実性が0.7以上の場合：
- 異なる視点から3つの仮説を立てる（例：具体的/抽象的/ユーザー視点）
- 各仮説にHaikuエージェントを割り当て、5分間で初期検証
- Ravenに3つの結果を評価してもらい、最適なパスを選択
- コスト：わずか3ユニットで方向性の誤りを回避

不確実性が0.7未満の場合：
- 従来通りSonnetで全体像を把握

### 2. 拡張判断
- 不確実性が0.7以上：専門エージェントを追加
- 調査領域が6個以上：Opusで調整役を立てる
- 複雑度が低い：Haikuを並列実行

### 3. 知識の集約
エージェント間でchat MCPを使って発見事項を共有。重複を避けて効率化。

## コスト最適化

- 単純タスクは複数のHaikuで並列処理
- Opusは本当に必要な時だけ使用
- 確信度が0.9を超えたら調査終了

## 適用例

- コードベース調査：最初にSonnetで概要把握→各コンポーネントをHaikuで詳細調査
- バグ調査：エラー分析をSonnet→原因候補それぞれをHaikuで検証
- セキュリティ監査：Opusで全体設計→Sonnetで各領域分析→Haikuで具体的な脆弱性検索